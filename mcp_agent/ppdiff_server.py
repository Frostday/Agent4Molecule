import os
from typing import Annotated
from pydantic import Field
import json
import subprocess
import time
import pandas as pd
import numpy as np
import glob
import random
import re

from run_utils import extract_job_id

PPDIFF_PATH = "/ocean/projects/cis240137p/dgarg2/github/PPDiff/"
PPDIFF_CONDA_ENV = "/ocean/projects/cis240137p/dgarg2/miniconda3/envs/ppdiff/bin/python"
COLABFOLD_CACHE = "/ocean/projects/cis240137p/dgarg2/github/colabfold/cf_cache"
COLABFOLD_SIF = "/ocean/projects/cis240137p/dgarg2/github/colabfold/colabfold_1.5.5-cuda12.2.2.sif"
import sys
sys.path.append(PPDIFF_PATH)

from mcp.server.fastmcp import FastMCP

mcp = FastMCP("ppdiff")


@mcp.tool()
def build_ppdiff_input(
    protein_seq: Annotated[list[str], Field(description="Sequence of the protein")],
    protein_atoms: Annotated[list[str], Field(description="Atoms of the protein")],
    protein_coors: Annotated[list[list[float]], Field(description="Coordinates of the protein")],
    protein_target: Annotated[list[int], Field(description="Generation target of the protein")]
) -> str:
    file_name = os.path.join(PPDIFF_PATH, "data/input.json")
    data = {"PDB": {"test": {"seqs": ["".join(protein_seq)], "atoms": [protein_atoms], "coors": [protein_coors], "target": [protein_target]}}}
    with open(file_name, "w") as f:
        json.dump(data, f, indent=4)
    return "Created input file for PPDiff: " + file_name


@mcp.tool()
def run_ppdiff(
    input_json: Annotated[str, Field(description="Location of data file")]
) -> str:
    os.chdir(PPDIFF_PATH)

    generation_file = f"""#!/bin/bash\ndata_path={input_json}\nrm -rf {PPDIFF_PATH}/models/output/PPDiff/*\n\nlocal_root=models\noutput_path=${{local_root}}/PPDiff\ngeneration_path=${{local_root}}/output/PPDiff\nmkdir -p ${{generation_path}}\n\n/ocean/projects/cis240137p/dgarg2/miniconda3/envs/PPDiff/bin/python fairseq_cli/validate.py ${{data_path}} --task protein_protein_complex_design --protein-task "PDB" --dataset-impl "protein_complex" --path ${{output_path}}/checkpoint_best.pt --batch-size 1 --results-path ${{generation_path}} --skip-invalid-size-inputs-valid-test --valid-subset test --eval-aa-recovery"""
    with open("generate_ppdiff.sh", "w") as f:
        f.write(generation_file)
    os.system("chmod +x generate_ppdiff.sh")

    slurm_file = f"""#!/bin/bash\n#SBATCH -N 1\n#SBATCH -p GPU-shared\n#SBATCH -t 1:00:00\n#SBATCH --gpus=v100-32:1\n#SBATCH --output=output.log\n#SBATCH -n 2\n#SBATCH -e output.err\nbash /ocean/projects/cis240137p/dgarg2/github/PPDiff/generate_ppdiff.sh"""
    with open("run_slurm.sh", "w") as f:
        f.write(slurm_file)
    os.system("chmod +x run_slurm.sh")

    p = subprocess.Popen(f"cd {PPDIFF_PATH} && sbatch run_slurm.sh", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    (output, err) = p.communicate()
    job_id = extract_job_id(output.decode('utf-8'))
    print("PPDiff Job ID:", job_id)
    while True:
        p = subprocess.Popen(['squeue', '-j', job_id], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        (output, err) = p.communicate()
        if job_id not in str(output):
            break
        print("Job still running...")
        time.sleep(120)

    with open(f"{PPDIFF_PATH}/output.log", "r") as f:
        logs = f.read()
    with open(f"{PPDIFF_PATH}/output.err", "r") as f:
        errors = f.read()

    return f"PPDiff Finished Successfully\nPredicted sequence from PPDiff: {PPDIFF_PATH}/models/output/PPDiff/binder.gen.txt\n\nLog File:\n\n----------\n" + logs + "\n----------\n\nError File:\n\n----------\n" + errors + "\n----------\n"


@mcp.tool()
def run_colabfold_on_ppdiff_output(
    sequence_file: Annotated[str, Field(description="Location of enzygen sequence file (protein.txt from enzygen)")],
    job_time: Annotated[str, Field(description="Time limit for AF2 jobs")] = "1:00:00",
):
    AF2_DIR = f"{PPDIFF_PATH}/af2_outputs/"
    os.makedirs(AF2_DIR, exist_ok=True)
    os.chdir(AF2_DIR)
    os.system(f"rm -rf {AF2_DIR}/*")
    
    with open(sequence_file, "r") as f:
        sequence = f.read()
    with open("input_seq.fasta", "w") as f:
        f.write(">ppdiff\n" + sequence)

    command = f"apptainer exec --nv -B {COLABFOLD_CACHE}:/cache -B {AF2_DIR}:/work {COLABFOLD_SIF} colabfold_batch /work/input_seq.fasta /work/out --msa-mode mmseqs2_uniref_env --pair-mode unpaired_paired --use-gpu-relax --num-seeds 1 --num-models 1 --model-type alphafold2_ptm"
    with open("submit_colabfold.sh", "w") as f:
        f.write(f"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -p GPU-small\n#SBATCH -t {job_time}\n#SBATCH --gpus=v100-32:1\n#SBATCH --output=output.log\n#SBATCH -n 2\n#SBATCH -e output.err\n{command}")

    p = subprocess.Popen(['sbatch', 'submit_colabfold.sh'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    (output, err) = p.communicate()
    job_id = extract_job_id(output.decode('utf-8'))
    print("Colabfold Job ID:", job_id)
    while True:
        p = subprocess.Popen(['squeue', '-j', job_id], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        (output, err) = p.communicate()
        if job_id not in str(output):
            break
        print("Job still running...")
        time.sleep(60)
    
    with open(os.path.join(AF2_DIR, "output.log"), "r") as f:
        logs = f.read()
    with open(os.path.join(AF2_DIR, "output.err"), "r") as f:
        errors = f.read()
    
    structures = []
    plddt_scores = []
    protein_pdbs = glob.glob(f"{AF2_DIR}/out/*.pdb")
    for pdb in protein_pdbs:
        scores_file = pdb.replace(".pdb", ".json").replace("unrelaxed", "scores")
        with open(scores_file, "r") as f:
            scores = json.loads(f.read())
        plddt_scores.append(float(np.mean(scores["plddt"])))
        with open(pdb, "r") as f:
            pdb = f.read()
        structures.append(f"File: {pdb}\n\n" + pdb)
    
    return f"Colabfold Job Completed\nAll output files: {protein_pdbs}\nAll plddt scores: {plddt_scores}\n\nLog File:\n\n----------\n" + logs + "\n----------\n\nError File:\n\n----------\n" + errors + "\n----------\n"


if __name__ == "__main__":
    mcp.run(transport='stdio')

    # out = build_ppdiff_input(
    #     protein_seq=list("SLRSDLINALYDENQKYDVCGIISAEGKIYPLGSDTAVLSTIFELFSRPIINKIAEKHGYIVEEPKQQNHYPDFTLYKPSEPNKKIAIDIKTTYTNKENEKIKFTLGGYTSFIRNNTKNIVYPFDQYIAHWIIGYVYTRVATRKSSLKTYNINELNEIPKPYKGVKVFLQDKWVIAGDLAGSGNTTNIGSIHAHYKDFVEGKGIFDSEDEFLDYWRNYERTSQLRNDKYNNISEYRNWIYRGRKSLRSDLINALYDENQKYDVCGIISAEGKIYPLGSDTAVLSTIFELFSRPIINKIAEKHGYIVEEPKQQNHYPDFTLYKPSEPNKKIAIDIKTTYTNKENEKIKFTLGGYTSFIRNNTKNIVYPFDQYIAHWIIGYVYTRVATRKSSLKTYNINELNEIPKPYKGVKVFLQDKWVIAGDLAGSGNTTNIGSIHAHYKDFVEGKGIFDSEDEFLDYWRNYERTSQLRNDKYNNISEYRNWIYRGRK"),
    #     protein_atoms=["CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA","CA"],
    #     protein_coors=[[-37.593,-7.826,18.845],[-33.958,-8.895,19.304],[-32.958,-5.988,17.18],[-35.041,-3.399,19.085],[-34.238,-4.611,22.611],[-30.498,-4.595,21.591],[-30.656,-1.034,20.277],[-32.482,-0.031,23.499],[-30.064,-1.891,25.755],[-27.029,-0.355,23.971],[-28.434,3.112,24.386],[-29.169,2.572,28.115],[-25.813,0.853,28.996],[-23.991,3.685,27.291],[-26.045,6.271,29.317],[-25.563,4.607,32.71],[-21.944,3.556,32.435],[-18.663,5.323,31.637],[-15.612,3.119,31.005],[-12.687,4.722,32.835],[-9.854,2.176,32.993],[-8.592,-1.364,33.102],[-8.557,-3.055,36.514],[-6.38,-5.839,37.837],[-7.348,-8.796,39.963],[-5.49,-7.084,42.787],[-7.683,-3.949,42.534],[-5.198,-1.548,40.862],[-6.597,0.525,37.953],[-4.656,1.851,34.902],[-6.297,4.771,32.999],[-7.293,4.801,29.352],[-5.256,6.347,26.509],[-6.843,8.635,23.846],[-6.411,6.938,20.413],[-9.158,4.892,18.537],[-6.814,1.876,19.095],[-7.657,2.02,22.806],[-11.238,3.06,22.341],[-12.439,0.657,19.677],[-11.085,-2.086,21.968],[-12.918,-0.575,24.964],[-16.301,-0.228,23.194],[-16.211,-3.71,21.788],[-15.579,-5.278,25.237],[-18.273,-2.962,26.69],[-20.788,-4.232,24.116],[-20.088,-7.954,24.778],[-22.211,-8.647,27.885],[-25.04,-6.47,26.387],[-25.152,-8.405,23.134],[-25.097,-11.713,24.918],[-27.846,-10.73,27.446],[-30.354,-9.529,24.847],[-29.484,-12.574,22.619],[-30.219,-14.959,25.524],[-33.433,-13.162,26.334],[-34.51,-13.957,22.748],[-33.336,-17.552,22.473],[-30.264,-16.892,20.329],[-26.875,-18.608,20.691],[-23.908,-16.163,20.749],[-20.567,-17.076,19.183],[-17.454,-14.948,18.874],[-14.713,-15.914,16.484],[-12.438,-18.834,17.498],[-9.684,-17.637,15.151],[-8.215,-14.101,15.044],[-8.864,-12.078,11.783],[-12.272,-13.573,11.208],[-15.493,-11.63,10.814],[-17.901,-10.977,12.532],[-17.488,-9.953,16.186],[-20.665,-11.871,17.044],[-22.66,-14.556,15.286],[-26.168,-15.121,16.624],[-28.604,-17.805,15.533],[-31.441,-19.855,17.002],[-30.415,-23.51,17.299],[-33.637,-24.466,15.448],[-32.699,-22.4,12.401],[-28.917,-22.627,11.879],[-28.989,-21.172,8.289],[-30.594,-17.994,9.592],[-27.512,-16.368,11.143],[-27.042,-12.825,12.216],[-23.635,-11.063,12.071],[-23.051,-8.179,14.43],[-19.825,-6.257,13.976],[-18.631,-3.37,16.193],[-16.984,-0.316,14.646],[-15.681,2.883,16.137],[-14.722,6.226,14.879],[-14.066,9.628,16.324],[-14.995,13.239,16.112],[-12.904,16.35,16.915],[-15.893,18.522,17.7],[-19.35,17.334,18.807],[-21.376,16.303,15.778],[-19.318,16.95,12.611],[-19.701,14.361,9.844],[-18.399,10.845,10.755],[-17.291,7.955,8.532],[-16.478,4.208,9.376],[-14.327,1.54,7.745],[-16.727,-1.4,7.42],[-14.485,-4.389,6.659],[-12.931,-5.722,3.481],[-14.648,-5.962,0.116],[-12.366,-8.729,-1.069],[-12.734,-11.479,1.549],[-16.091,-13.028,2.455],[-18.305,-10.912,0.135],[-16.127,-12.395,-2.627],[-15.499,-15.954,-1.311],[-18.142,-17.73,0.755],[-15.71,-19.015,3.436],[-12.889,-16.479,3.561],[-12.16,-14.68,6.899],[-15.585,-15.421,8.215],[-16.636,-17.724,11.099],[-19.44,-19.533,9.181],[-19.976,-19.475,5.371],[-21.336,-16.134,4.149],[-24.403,-17.778,2.714],[-25.655,-18.867,6.168],[-26.143,-15.231,7.322],[-29.446,-13.496,6.609],[-28.407,-10.206,8.293],[-25.288,-8.146,8.909],[-25.564,-5.483,11.58],[-23.083,-2.791,12.423],[-22.953,-1.544,16.085],[-21.229,1.772,15.588],[-19.717,4.021,18.338],[-18.556,7.684,17.924],[-16.847,9.723,20.53],[-15.312,13.172,20.684],[-11.546,13.117,21.214],[-10.103,14.56,24.446],[-6.368,15.083,25.013],[-5.046,12.891,27.869],[-3.863,14.685,30.964],[-0.759,13.91,33.094],[-3.089,12.378,35.665],[-3.571,9.574,33.068],[-0.071,8.362,33.972],[-0.807,7.426,37.554],[-2.63,4.356,38.767],[-5.798,4.41,40.931],[-7.727,2.407,43.509],[-11.395,1.411,43.522],[-12.167,4.48,45.745],[-11.127,6.993,43.037],[-13.087,5.627,40.017],[-14.945,8.934,39.638],[-11.791,10.979,39.331],[-9.871,8.97,36.75],[-9.704,11.262,33.651],[-11.42,9.93,30.496],[-9.901,10.376,27.019],[-13.275,10.975,25.412],[-16.649,12.665,25.732],[-20.046,12.423,24.143],[-19.939,8.797,23.024],[-23.009,7.86,20.961],[-23.928,4.429,19.716],[-26.208,3.055,16.95],[-27.121,-0.285,15.402],[-27.895,-0.394,11.658],[-27.711,-2.819,8.741],[-24.324,-2.841,7.082],[-25.712,-2.272,3.555],[-27.843,0.716,4.639],[-24.868,2.663,5.899],[-22.336,1.553,3.22],[-20.924,4.244,0.974],[-19.381,3.966,-2.494],[-15.764,5.046,-1.77],[-13.078,2.789,-0.258],[-12.637,3.103,3.561],[-8.939,2.132,3.306],[-6.476,1.464,0.465],[-3.883,-1.22,1.226],[-6.455,-3.091,3.443],[-9.329,-2.736,0.913],[-12.19,-1.784,3.234],[-15.704,-0.743,2.295],[-16.151,2.912,3.335],[-19.43,3.861,5.043],[-21.352,7.013,4.079],[-19.84,10.29,5.477],[-22.65,11.848,7.44],[-23.864,12.958,10.848],[-24.692,10.534,13.579],[-28.519,10.967,12.91],[-28.23,9.669,9.344],[-26.738,6.414,10.624],[-29.449,5.837,13.17],[-32.08,6.714,10.538],[-30.602,4.883,7.603],[-30.14,7.673,5.057],[-27.686,5.824,2.885],[-27.06,5.718,-0.868],[-27.723,2.183,-2.004],[-31.26,1.397,-3.1],[-30.946,-2.169,-1.833],[-28.679,-4.789,-0.306],[-28.347,-6.551,-3.715],[-26.985,-3.288,-5.211],[-24.625,-2.752,-2.227],[-23.216,-6.28,-2.658],[-23.013,-6.032,-6.406],[-21.133,-2.747,-6.134],[-18.495,-3.823,-3.657],[-18.084,-7.179,-5.327],[-17.225,-5.469,-8.622],[-15.317,-2.562,-7.144],[-11.694,-2.409,-8.532],[-8.821,-1.953,-5.986],[-6.926,1.054,-7.482],[-7.884,4.395,-9.045],[-6.483,3.397,-12.392],[-8.367,0.13,-12.479],[-11.738,1.526,-11.5],[-11.409,4.286,-14.08],[-12.51,2.027,-16.923],[-15.29,0.643,-14.703],[-16.606,2.873,-11.895],[-15.312,5.072,-8.995],[-18.778,5.877,-7.599],[-22.492,4.952,-7.287],[-23.484,7.045,-10.334],[-20.87,5.601,-12.595],[-21.893,2.18,-11.331],[-25.634,2.718,-12.174],[-24.591,3.923,-15.597],[-22.302,0.896,-15.911],[-25.161,-1.36,-14.864],[-27.436,0.372,-17.254],[-25.308,-0.053,-20.327],[-24.987,-3.818,-19.723],[-22.152,-4.144,-17.199],[-19.422,-2.638,-19.41],[20.056,3.527,34.964],[16.791,4.47,33.24],[17.053,1.311,31.199],[17.911,-1.059,34.07],[15.194,0.445,36.253],[12.598,0.271,33.533],[13.28,-3.4,32.775],[12.977,-4.17,36.516],[9.868,-2.086,37.071],[8.179,-3.974,34.126],[9.219,-7.427,35.422],[7.819,-6.616,38.861],[4.593,-4.946,37.767],[3.787,-7.879,35.5],[4.719,-10.195,38.389],[2.388,-8.441,40.813],[-0.695,-7.544,38.801],[-2.984,-9.41,36.385],[-5.302,-7.25,34.329],[-8.768,-8.794,34.345],[-11.251,-6.384,32.788],[-12.208,-2.858,31.962],[-13.988,-0.908,34.706],[-16.477,1.938,34.683],[-16.702,4.933,36.957],[-19.765,3.338,38.545],[-17.899,0.129,39.458],[-19.185,-2.28,36.765],[-16.496,-4.563,35.27],[-16.478,-5.954,31.654],[-14.192,-8.954,30.964],[-11.459,-9.07,28.377],[-11.553,-10.685,24.957],[-8.93,-13.277,23.929],[-7.416,-11.858,20.733],[-4.219,-9.763,20.412],[-6.337,-6.804,19.233],[-7.573,-6.681,22.861],[-4.467,-7.719,24.794],[-2.151,-5.557,22.718],[-4.165,-2.585,24.014],[-4.243,-3.825,27.639],[-0.454,-4.312,27.878],[0.32,-0.876,26.442],[-2.055,0.786,28.955],[-0.696,-1.393,31.777],[2.704,-0.078,30.785],[2.035,3.662,30.725],[2.187,4.301,34.526],[5.377,2.23,34.933],[7.238,3.937,32.124],[6.196,7.415,33.458],[7.254,6.669,37.029],[10.8,5.51,36.017],[11.254,8.297,33.45],[10.39,11.08,35.922],[12.674,9.436,38.511],[15.494,9.769,36.001],[14.506,13.331,35.131],[12.956,12.591,31.706],[9.962,14.249,30.169],[7.509,11.681,28.777],[5.341,12.411,25.825],[2.835,10.206,24.062],[1.926,11.014,20.476],[-0.577,13.925,20.208],[-1.6,12.457,16.843],[-2.863,9.07,15.721],[-0.623,6.428,14.229],[2.544,8.366,14.693],[5.371,6.352,16.254],[6.579,5.95,19.123],[4.239,5.061,21.979],[6.569,7.012,24.301],[9.19,9.66,23.639],[11.444,10.348,26.691],[14.007,13.151,27.064],[15.644,15.817,29.161],[14.965,19.399,28.136],[18.706,19.994,28.394],[19.285,17.282,25.757],[16.708,17.951,22.962],[18.457,15.759,20.37],[19.144,12.813,22.62],[15.558,11.542,22.809],[14.622,7.932,23.555],[11.853,6.145,21.664],[9.979,3.388,23.401],[7.457,1.229,21.529],[5.155,-1.539,22.955],[4.686,-4.712,20.85],[2.675,-7.826,21.68],[2.537,-11.36,20.303],[1.132,-14.711,21.395],[2.136,-18.378,21.547],[-0.127,-21.392,21.465],[2.067,-23.176,24.005],[4.184,-21.83,26.818],[7.874,-21.268,26.004],[7.944,-21.669,22.135],[9.437,-19.288,19.483],[7.828,-15.893,19.061],[8.067,-13.108,16.467],[7.02,-9.448,16.576],[5.986,-6.926,13.916],[8.243,-3.926,14.6],[6.654,-1.046,12.683],[7.024,0.153,9.13],[10.206,-0.059,7.104],[8.956,2.693,4.793],[7.88,5.473,7.058],[10.211,7.326,9.379],[13.264,5.178,8.701],[13.165,6.312,5.032],[11.843,9.767,5.767],[12.876,11.872,8.726],[9.464,13.286,9.74],[6.949,10.672,8.346],[4.631,9.179,10.969],[6.888,10.057,13.879],[6.348,12.425,16.826],[9.75,14.105,16.571],[12.011,13.952,13.478],[13.92,10.654,13.37],[17.391,12.184,13.668],[16.542,13.504,17.194],[16.311,9.972,18.69],[19.458,8.23,20.034],[17.762,5.017,21.143],[14.699,3.029,19.949],[13.572,0.509,22.577],[10.903,-2.165,22.204],[9.007,-3.409,25.218],[7.663,-6.747,24.02],[4.886,-8.713,25.645],[4.244,-12.423,25.008],[1.2,-14.301,26.305],[-0.198,-17.837,25.875],[-3.699,-17.743,24.312],[-6.506,-19.262,26.37],[-10.098,-19.219,24.701],[-12.949,-17.179,26.169],[-15.661,-18.953,28.141],[-19.354,-18.199,28.554],[-18.446,-16.499,31.864],[-16.48,-13.818,29.914],[-19.881,-12.52,28.613],[-21.253,-11.408,32.002],[-20.43,-8.248,33.99],[-19.01,-8.184,37.539],[-18.53,-5.861,40.47],[-15.442,-4.945,42.492],[-16.145,-7.934,44.812],[-15.805,-10.678,42.171],[-12.405,-9.637,40.807],[-10.578,-12.915,41.275],[-13.626,-14.61,39.773],[-13.266,-12.981,36.348],[-11.758,-15.266,33.758],[-8.542,-13.994,32.088],[-8.099,-14.915,28.334],[-4.35,-15.466,28.805],[-1.765,-17.15,31.005],[2.017,-17.036,31.21],[2.621,-13.389,30.281],[6.306,-12.404,29.876],[7.733,-8.951,29.164],[11.134,-7.747,27.867],[12.81,-4.447,26.934],[15.452,-4.444,24.255],[16.847,-2.271,21.441],[14.854,-2.354,18.167],[17.874,-2.964,15.942],[19.125,-5.792,18.183],[15.958,-7.847,17.903],[15.229,-6.927,14.224],[15.127,-9.842,11.781],[15.75,-9.953,8.017],[12.226,-11.027,6.784],[9.21,-8.662,6.676],[6.697,-8.896,9.58],[3.826,-7.975,7.258],[3.16,-7.573,3.565],[0.575,-4.986,2.544],[1.587,-2.889,5.531],[5.335,-3.317,5.034],[6.596,-4.021,8.644],[10.037,-5.136,9.788],[9.706,-8.655,11.187],[11.765,-9.363,14.375],[13.918,-12.485,14.776],[11.812,-15.623,15.333],[13.329,-16.989,18.58],[12.727,-17.859,22.227],[11.977,-15.244,24.881],[15.5,-15.493,26.355],[16.957,-14.583,22.994],[15.075,-11.247,23.011],[16.051,-10.451,26.62],[19.671,-11.316,25.931],[19.745,-9.748,22.484],[20.843,-12.688,20.323],[20.093,-10.865,17.105],[21.421,-11.052,13.559],[22.585,-7.578,12.667],[26.168,-6.451,13.404],[25.307,-2.898,14.174],[22.373,-0.533,14.182],[23.74,0.978,10.884],[23.559,-2.421,9.242],[20.028,-2.723,10.621],[19.142,0.583,9.071],[20.839,0.075,5.727],[19.185,-3.273,5.3],[15.608,-2.131,6.045],[16.084,1.057,4.084],[16.918,-0.925,0.906],[14.624,-3.912,1.309],[12.194,-4.006,-1.695],[8.477,-4.291,-0.863],[7.769,-7.421,-2.836],[9.449,-10.708,-3.517],[9.855,-10.191,-7.278],[11.545,-6.853,-6.567],[13.729,-8.396,-3.822],[14.335,-11.507,-5.969],[17.64,-10.427,-7.315],[18.776,-7.74,-4.845],[18.514,-9.547,-1.42],[15.896,-11.469,0.543],[17.785,-12.153,3.758],[20.94,-10.915,5.576],[23.516,-13.193,3.964],[22.289,-12.047,0.477],[22.357,-8.428,1.72],[25.922,-8.978,2.925],[26.852,-10.324,-0.547],[25.026,-7.406,-2.103],[27.113,-4.976,-0.059],[30.224,-6.951,-0.906],[29.688,-6.719,-4.636],[29.016,-2.932,-4.711],[25.311,-2.737,-3.957],[24.193,-4.39,-7.189]], 
    #     protein_target=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    # )
    # print(out)

    # time.sleep(5)

    # out = run_ppdiff("/ocean/projects/cis240137p/dgarg2/github/PPDiff/data/input.json")
    # print(out)

    # time.sleep(5)

    # out = run_colabfold_on_ppdiff_output(f"{PPDIFF_PATH}/models/output/PPDiff/binder.gen.txt")
    # print(out)
